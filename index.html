<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

	<title>xtpl — больше, чем JavaScript шаблонизатор</title>

	<meta name="keywords"
		  content="xtpl, javascript, template, nodejs, browser, server, client, binding, data-binding, MVVM, rubaxa"/>

	<meta name="description"
		  content="xtpl — JavaScript шаблонизатор нового поколения, работает как на клиенте, так и сервере.
		           Позволяет связывать данные с шаблоном и многое другое."/>



	<link rel="stylesheet" href="http://designmodo.github.io/Flat-UI/bootstrap/css/bootstrap.css" />
	<link href='http://fonts.googleapis.com/css?family=Wire+One' rel='stylesheet' type='text/css'>

	<style>
		body {
			color: #383e4b;
			background-color: #f5f5f5;
			min-width: 800px;
		}

		#main {
			margin: 150px 0;
			text-align: center;
			font-size: 100px;
			font-family: 'Wire One', sans-serif;
			opacity: 0;
		}

		#sidebar-left {
			color: #fff;
			height: 100%;
			position: absolute;
			font-size: 14px;
			font-family: Lato, sans-serif;
			background-color: rgb(56, 62, 75);
		}
			#sidebar-left a {
				color: #fff;
				border: 0;
				border-radius: 0;
				background-color: transparent;
			}
				#sidebar-left a:hover,
				#sidebar-left .active a {
					background-color: rgb(45, 50, 61);
				}


		#content {
			width: 85%;
			margin: 0 auto;
			padding: 0 20px;
		}

		.well {
			border: 0;
			padding: 15px 20px;
			border-radius: 3px;
			box-shadow: 0 1px 0 1px #e4e6eb;
			background-color: #fff;
		}

		.btn.xlarge {
			font-size: 30px;
			padding: 15px 30px;
		}

		.code { white-space: nowrap; }
			.code-node { color: #006; }
			.code-class { color: #060; }
			.code-prop { color: #800080; }
			.code-xprop { color: #800080; font-style: italic; }
			.code-str { color: #060; }
			.code-comment { color: #999; }

		.well {
			max-height: 300px;
			overflow: auto;
		}

		.done-true {
			text-decoration: line-through;
		}

		.todoapp input {
			vertical-align: top;
			margin-right: 10px;
		}

		.teach-me {
			margin: 150px 0 180px;
			text-align: center;
		}
			.teach-me a {
				font-size: 100px;
				font-family: 'Wire One', sans-serif;
			}


		#main {
			-webkit-transition: all 1s ease-in;
			-moz-transition: all 1s ease-in;
			transition: all 1s ease-in;
		}

		.example .code,
		.example .preview {
			top: 10px;
			opacity: 0;
			position: relative;
			-webkit-transition: all .6s ease-out;
			-moz-transition: all .6s ease-out;
			transition: all .6s ease-out;
		}
			.example .preview {
			 	-webkit-transition-delay: .2s;
			 	-moz-transition-delay: .2s;
			}

			.example.show .code,
			.example.show .preview {
				top: 0;
				opacity: 1;
			}
	</style>
</head>
<body>
	<script x-ctrl="main" type="text/xtpl">
		// Main Page
		.splash {
			.row-fluid {
				// Page content
				div#content {
					h1#main {
						x-fade-to: ctx.showH1
						| Simple. Easy. Quickly.
					}

					// "Hello"
					.row-fluid.example {
						class: { show: ctx.examples.hello.show; }

						.span7.well.code | {* ctx.examples.hello.xtpl | xcode *}
						.span5.preview { x-eval: ctx.examples.hello.xtpl }
					}

					// "Counter"
					.row-fluid.example {
						class: { show: ctx.examples.counter.show; }

						.span7.well.code | {* ctx.examples.counter.xtpl | xcode *}
						.span5.well.preview[style="text-align: center"] { x-eval: ctx.examples.counter.xtpl }
					}

					// "List"
					.row-fluid.example {
						class: { show: ctx.examples.list.show; }

						.span7.well.code | {* ctx.examples.list.xtpl | xcode *}
						.span5.well.preview[x-ctrl="list"] { x-eval: ctx.examples.list.xtpl }
					}

					// "Todos app"
					.row-fluid.example {
						class: { show: ctx.examples.todos.show; }

						.span7.well.code | {* ctx.examples.todos.xtpl | xcode *}
						.span5.well.todoapp.preview[x-ctrl="todos"] { x-eval: ctx.examples.todos.xtpl }
					}
				}
			}

			.teach-me {
				a[href="#!/api/"] | Shut up and teach me!
			}
		}
	</script>



	<script src="/js/xtpl.min.js"></script>
	<script>
		xtpl.ctrl('main', function (ctx){
			xtpl.mod('xcode', function (code){
				code	= code.split('\n');
				xtpl.utils.each(code, function (line, i){
					code[i] = line
						.replace(/(\|[^$]+)/, function (_, val){
							return val.replace(/&/g, '&amp;').replace(/"/g, '&quot;');
						})
						.replace(/(".*?")/g, '<span class="code-str">$1</span>')
						.replace(/^(\s*)(\w+)([.\s#\[])/g, '$1<span class="code-node">$2</span>$3')
						.replace(/((?:^\s*|>)\.)([.\w-]+)/g, '$1<span class="code-class">$2</span>')
						.replace(/(\s)(x-\w+:)/g, '$1<span class="code-xprop">$2</span>')
						.replace(/(\s)(\w+:)/g, '$1<span class="code-prop">$2</span>')
						.replace(/\[(\w[^=]+)/g, '[<span class="code-prop">$1</span>')
						.replace(/\t/g, '&nbsp; &nbsp;')
						.replace(/\s{2}/g, '&nbsp; &nbsp;')
						.replace(/(\/\/[^$]+)/, '<span class="code-comment">$1</span>')
					;
				});
				return	code.join('<br/>');
			});

			ctx.counter = 0;

			ctx.sidebar = {
				items: [
					  { path: '/', text: 'About' }
					, { path: '/started', text: 'Getting started' }
				],
				path: location.path
			};

			ctx.examples = (function (){
				var res = {};
				var xhr = new XMLHttpRequest();
				xhr.open("GET", "./examples/splash.xtpl", false);
				xhr.send(null);

				xtpl.utils.each(xhr.responseText.split('----- '), function (code){
					var name;
					code = code.replace(/^(.*?) -----/, function (_, val){ name = val; return '' });
					res[name] = { xtpl: code.trim() };
				});
				return	res;
			})();


			// Animation
			ctx.$delay(function (){
				ctx.$set('showH1', true);
				xtpl.utils.each(['hello', 'counter', 'list', 'todos'], function (name, i){
					ctx.$delay(function (){
						ctx.examples[name].show = true;
					}, 200 * (i + 1));
				});
			});
		});


		xtpl.ctrl('list', function (ctx){
			// New item model
			ctx.newItem = '';

			// Default items
			ctx.items = ['Alpha', 'Beta', 'Gamma'];

			// Active item index in items
			ctx.activeIdx = 0;

			// Add to items
			ctx.addItem = function (){
				if( ctx.newItem.length > 0 ){
					ctx.items.push(ctx.newItem);
					ctx.newItem = '';
				}
			};

			// @const
			ctx.SORT_ASC = function (a, b){
				return	a == b ? 0 : (a > b ? 1 : -1);
			};

			// @const
			ctx.SORT_DESC = function (a, b){
				return	a == b ? 0 : (a > b ? -1 : 1);
			};

			// Sort items by type
			ctx.sortItems = function (fn){
				ctx.items.sort(fn);
			};
		});


		xtpl.ctrl('todos', function (ctx){
			ctx.todos = [
				{text: 'learn angular', done: true},
				{text: 'build an angular app', done: false}
			];

			ctx.addTodo = function (){
				ctx.todos.push({text: ctx.todoText, done: false});
				ctx.todoText = '';
			};

			ctx.remaining = function (){
				var count = 0;
				xtpl.each(ctx.todos, function (todo){
					count += todo.done ? 0 : 1;
				});
				return count;
			};

			ctx.archive = function (){
				var oldTodos = ctx.todos;
				ctx.todos = [];
				xtpl.each(oldTodos, function (todo){
					if( !todo.done ) ctx.todos.push(todo);
				});
			};

			return	ctx;
		});
	</script>

</body>
</html>
