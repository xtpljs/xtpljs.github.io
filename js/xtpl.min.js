/*! xtpl 0.1.0 - MIT | git://github.com/rubaxa/xtpl.git */
"use strict";(function(t){"function"==typeof define&&define.amd?define("xtpl",[],t):window.xtpl=t()})(function(){function t(n,r){var i={exports:{}};r(i,i.exports,e),t[n]=i.exports}function e(e){return t[e]}return t("utils",function(t){var e,n=/[&<>"]/,r=/&/g,i=/>/g,a=/</g,o=/"/g,s=[].slice;void 0===String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")}),void 0===Function.prototype.bind&&(Function.prototype.bind=function(t){var e=s.call(arguments,1),n=this;return function(){return n.apply(t,e.concat(s.call(arguments,0)))}}),t.exports=e={isClient:"undefined"!=typeof navigator,shortTags:{area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1,space:1,enter:1},extend:function(t,e){var n;t=t||{};for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},each:function(t,e,n){if(t){var r=0,i=t.length;if(i>=0&&0 in t)for(;i>r;r++)e.call(n,t[r],r,t);else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}},map:Array.map||function(t,e,n){for(var r=[],i=0,a=t.length;a>i;i++)r.push(e.call(n,t[i],i,t));return r},filter:Array.filter||function(t,e,n){for(var r=[],i=0,a=t.length;a>i;i++)e.call(n,t[i],i,t)&&r.push(t[i]);return r},inArray:Array.indexOf||function(t,e){for(var n=t.length;n--;)if(t[n]===e)return n;return-1},isEmptyObject:function(t){for(var e in t)return!1;return!0},escapeHTML:function(t){return"string"==typeof t?n.test(t)&&(~t.indexOf("&")&&(t=t.replace(r,"&amp;")),~t.indexOf("<")&&(t=t.replace(a,"&lt;")),~t.indexOf(">")&&(t=t.replace(i,"&gt;")),~t.indexOf('"')&&(t=t.replace(o,"&quot;"))):void 0===t&&(t=""),t},notEqual:function l(t,e){var n,r=typeof e;if(typeof t!==r&&"object"===r)return!0;if(e instanceof Array){if(n=e.length,t.length!==n)return!0;for(;n--;)if(l(t[n],e[n]))return!0}else{if("object"!==r)return t!=e;for(n in e)if(e.hasOwnProperty(n)&&l(t[n],e[n]))return!0;for(n in t)if(t.hasOwnProperty(n)&&l(t[n],e[n]))return!0}return!1},simpleNotEqual:function l(t,e){var n,r=typeof e;if(typeof t!==r&&"object"===r)return!0;if(e instanceof Array){if(n=e.length,t.length!==n)return!0;for(;n--;)if(t[n]!==e[n])return!0}else{if("object"!==r)return t!=e;for(n in e)if(e.hasOwnProperty(n)&&l(t[n],e[n]))return!0;for(n in t)if(t.hasOwnProperty(n)&&l(t[n],e[n]))return!0}return!1},simpleClone:function(t){var e,n=t;if(t instanceof Array)for(e=t.length,n=[];e--;)n[e]=t[e];else if(t instanceof Function)n=t;else if(t instanceof Object){n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e])}return n},print:function(){console.log(e.map(arguments,function(t){return t?(""+JSON.stringify(t)).replace(/^"|"$/g,""):t}))},error:function(t,e,n){console.log(t.message+"\nline: "+(n||t.line||t.lineNumber)+"\nfile: "+(e||t.file||t.filename))},matchAll:function(t,e){for(var n,r=[];n=e.exec(t);)void 0!==n[1]&&r.push(n.slice(1));return r},throttel:function(t,e,n){var r,i,a,o,s=function(){a.call(n)};return function(t,e){o=(new Date).getTime(),a=t,void 0===r?(i=o,r=setTimeout(s,e)):o-i>=e&&(clearTimeout(r),r=void 0,s())}},readFile:function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}}}),t("xmlparser",function(t,e,n){function r(t,e){return new i(t,e)}function i(t,e){this.name=t||"#",this.shorty=void 0!==E[t],this.value="",this.attrs=e||{},this.length=0,this.children=[],this.binding=[]}var a=function(t){return t.charCodeAt(0)},o=/^[\r\n\s\t]+$/,s=a("\n"),l=a("<"),c=a(">"),u=a("="),f=a("a"),d=a("z"),p=a("0"),h=a("9"),v=a("-"),x=a(":"),m=a('"'),g=a("/"),_=(a("\\"),33),y=1,b=2,w=n("utils"),C=w.each,E=w.shortTags,$=function(t,e,n){function i(t){var e,r=n[t.name];void 0!==r&&(e="string"==typeof r?r:r(t,t.attrs),"string"==typeof e&&t.replace(e))}function a(t){var r,i=n["#text"],a=t.value;if(void 0!==i&&(r=i(a,t),r!==a)){var o=e.line;r=$(r,e,n),e.line=o,t.replace(r.children)}}function w(e){var n=t.indexOf("\n",L),r=L-q+1;throw 0>=n&&(n=t.length),{file:P,line:F+":"+r,message:e+"\n"+t.substring(q,n).replace(/\t/g," ")+"\n"+Array(r).join("-")+"^"}}function C(){var e=t.charCodeAt(++L);for(e!==m&&w('"'+j+'" expected value of the attribute in quotes'),S=++L;D>L;){if(E=t.charCodeAt(L),e===E)return t.substring(S,L);L++}L-=0|(L-S)/2+1,w('Unclosed string literal in "'+j+'" attribute')}n=n||{},e=e||{};for(var E,k,A,T,O,j,N,L=0,S=0,D=t.length,M=r("#root"),F=e.line||1,P=e.file,q=0,B=0,z=null==e.trim?1:e.trim;D>L;)E=t.charCodeAt(L),_>E&&E===s&&(q=L+1,F++),T===y?E===c||E===g&&t.charCodeAt(++L)===c?(O=t.substring(k,B+1),T=void 0,B=L+1,"#"===M.name?(M.name=O,E===g&&(M.shorty=!0,i(M),M=M.parent)):M.name===O?(i(M),M=M.parent):w('Wrong close "'+O+'" tag should be "'+M.name+'"')):_>E?(S=L,T=b,A=void 0):E>=f&&d>=E||E>=p&&h>=E||E===v||E===x?B=L:w("Invalid character in node name"):T===b?E===g||E===c?(void 0!==A&&M.attr(t.substring(A,L).trim(),!0),L--,T=y):E===u||_>E?void 0!==A&&(j=t.substring(A,L).trim(),M.attr(j,_>E?!0:C()),A=void 0):(f>E||E>d)&&E!==v&&E!==x?w("Invalid character in attrbiute name"):void 0===A&&(A=L):E===l&&(L-B>0&&(N=t.substring(B,L),(0===z||o.test(N)===!1)&&(M.appendText(N),a(M.last))),t.charCodeAt(L+1)===g?L++:(M=M.newChild(),M.file=P,M.line=F),k=L+1,T=y),L++;return T===y?w('"'+t.substring(k,L)+'" tag should be closed'):"#root"!==M.name&&w('"'+M.name+'" tag should be closed'),L-B>0&&(N=t.substring(B,L),(0===z||o.test(N)===!1)&&(M.appendText(N),a(M.last))),M};i.prototype={create:function(t,e){return r(t,e)},attr:function(t,e){return this.attrs[t]=e,this},bind:function(t){t.binded=this.binded=!0,this.binding.push(t)},on:function(t,e){void 0===this.events&&(this.events=[]),this.events.push(t.replace(/^.+[:-]+/,""),e)},bindDecl:function(t,e){void 0===this.decl&&(this.decl=[]),this.decl.push(t,e)},closest:function(t){var e=this.parent;if(e.name!==t)for(;(e=e.parent)&&e.name!==t;);return e},index:function(){for(var t=this.parent.children,e=t.length;e--;)if(t[e]===this)return e;return-1},append:function(t,e){var n=this.children;return void 0===e?n.push(t):n.splice(e.index(),0,t),this.first=n[0],this.last=n[(this.length=n.length)-1],t.parent=this,this},appendArray:function(t){return C(t,function(t){this.append(t)},this),this},empty:function(){return this.children=[],this.length,delete this.first,delete this.last,this},remove:function(){var t=this.parent,e=t.children,n=this.index();return-1!==n&&e.splice(n,1),t.first=e[0],t.last=e[(t.length=e.length)-1],this},find:function(t){var e=[],n=">"!=t.charAt(0);return t=t.replace(">",""),C(this.children,function r(i){(i.name===t||"*"===t)&&e.push(i),n&&C(i.children,r)}),e},wrap:function(t,e){var n=r(t,e);return n.file=this.file,n.line=this.line,this.parent.append(n,this),n.append(this.remove()),n},innerWrap:function(t,e){var n=r(t,e),i=this.children,a=0,o=i.length;for(this.children=[];o>a;a++)n.append(i[a]);return this.append(n)},replace:function(t){var e=this.parent,n=[].concat(t),r=0,i=n.length;for(this.remove();i>r;r++)t=n[r],"string"==typeof t?e.appendText(t):e.append(t);return this},appendText:function(t){if(""!==t){var e=this.last;void 0===e||"#text"!==e.name?this.newChild("#text").value=t:e.value+=t}return this},newChild:function(t,e){var n=r(t,e);return n.file=this.file,n.line=this.line,this.append(n),n},exception:function(t){throw{message:'Tag "'+this.name+'", '+t,line:this.line,file:this.file}},clone:function(){var t=r();return C(this,function(e,n){"children"===n?C(e,function(e){t.append(e.clone())}):/first|last/.test(n)||(t[n]=w.simpleClone(e))}),t},toString:function(t,e){e=t&&e||"",t=t?"\n":"";var n=e+this.value;if(C(this.children,function(r){n+=r.toString(t,"  "+e)}),"#"!=this.name.charAt(0)){var r,i,a=t+e+"<"+this.name,o=[];for(r in this.attrs)i=this.attrs[r],i===!0?o.push(r):o.push(r+'="'+i+'"');o.length&&(a+=" "+o.join(" ")),n=a+(this.shorty&&!this.length?"/>":">"+n+t+e+"</"+this.name+">")}return n}},$.newNode=r,t.exports=$}),t("xparser",function(t,e,n){(function(){var e=n("xmlparser"),r=e.newNode,i=function(t){return t.charCodeAt(0)},a=function(t){return String.fromCharCode(t)},o=0,s=i("\n"),l=i("{"),c=i("}"),u=i("("),f=(i(")"),i("[")),d=i("]"),p=i("="),h=i("a"),v=(i("z"),i("0")),x=i("9"),m=i("\n"),g=i(">"),_=i("&"),y=i("."),b=i("#"),w=i("|"),C=i(","),E=i(":"),$=i("-"),k=i('"'),A=i("'"),T=i("/"),O=i("\\"),j=33,N=++o,L=++o,S=++o,D=++o,M=++o,F=(++o,++o),P=++o,q=++o,B=++o,z=(++o,n("utils").each),H=/(width|height|left|right|top|bottom|font-size|text-indent)$/,I="a abbr acronym address applet area article aside audio b base basefont bdi bdo big blockquote body br canvas caption center cite code col colgroup command datalist dd del details dfn dialog dir div dl dt em embed fieldset figcaption figure font footer form frame frameset h1 to h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link map mark menu meta meter nav noframes noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr track tt u ul var video wbr".split(" "),W={"if":function(t){return r("x:if",{test:t})},"else":function(t,e){var n=r("x:else");return n.shorty=!0,/^if\b/.test(t)&&(n.attrs["if"]=t.substr(2).trim()),e.last.append(n)},elseif:function(t,e){return W["else"]("if "+t,e)},"for":function(t,e){return W.each(t,e)},each:function(t){return t=t.match(/^\(?(\w+)(?:\s|,)\s*(\w+)?\)?\s*in\s*([^\|]+)(\|.+)?/i),r("x:each",{data:t[3],as:t[2]||t[1],key:t[2]?t[1]:"$index",filter:/^\|/.test(t[t.length-1])?t.pop().substr(1):void 0})}};z(I,function(t){I[t]=1});var R=function(t,n,i){function o(e,n){var r=t.indexOf("\n",oe),i=oe-de+1;0>=r&&(r=t.length);try{r()}catch(a){console.log(a.stack.split("\n").slice(1).join("\n"))}throw{file:fe,line:ue+":"+i,message:e+"\n"+t.substring(de,r).replace(/\t/g," ")+"\n"+Array(i+(0|n)).join("-")+"^"}}function I(t,e){var n;try{n=Function("return "+t)()}catch(r){if(r instanceof ReferenceError)return e?{expr:t,str:t}:"{{"+t+"}}";o(r.message+"\n---\n"+t+"\n---")}return e?{value:t,str:t,result:n}:n}function R(t){var r,a=ce.newChild("#text"),o=i["#text"],s=a.value=t;if(void 0!==o&&(r=o(s,a),r!==s)){var l=n.line;r=e(r,n,i),n.line=l,a.replace(r.children)}return a}function J(){var e,n;for(se=oe;le>oe;){if(Y=t.charCodeAt(oe),Y===k||Y===A||Y===O&&!/["')]/.test(a(Z))){for(oe++,Z=Y;le>oe;){if(Y=t.charCodeAt(oe),Y===O)e=!e;else{if(Y===Z&&!e)break;e=0}oe++}oe>=le&&o("Unterminated string")}else{if(Y===C||Y===c||Y===m)return n=t.substring(se,oe).trim().replace(/[;,]$/,""),se=oe+1,oe--,n;if(Y===l)break}Y>j&&(Z=Y),oe++}oe=se}function U(e){for(se=oe+(0|e);le>oe&&(Y=t.charCodeAt(oe),Y!==s);)oe++;return t.substring(se,oe)}function G(t){var e,n=i[t.name];void 0!==n&&(e="string"==typeof n?n:n(t,t.attrs),"string"==typeof e&&t.replace(e))}function Q(t){return z(t.attrs,function(e,n){var r=e;delete t.attrs[n],"string"==typeof e?/^x[:-]/.test(t.name)||/^x-/.test(n)||(r=I(r)):e instanceof Object&&(r="",z(e,function(e,i){e=I(e,!0),"class"===n?void 0!==e.expr?(i=i.replace(/^([^'"])/,'"$1').replace(/([^'"])$/,'$1"'),r+=" {{"+e.expr+" ? "+i+' : ""}}'):e.result&&(r+=" "+i.trim().replace(/(^["']|["']$)/g,"")):"style"===n?r+=i+":"+(void 0!==e.expr?"{{"+e.expr+"}}":e.result)+(H.test(i)&&(e.expr?!/(\+\s*["'](%|[a-z]{2,3})['"]|%)$/.test(e.str):/^\d+(\.\d+)?$/.test(e.str))?"px":"")+";":(r=void 0,t.attrs[n+"-"+i]=void 0!==e.expr?"{{"+e.expr+"}}":e.result)})),void 0!==r&&(t.attrs[n]=r)}),t.parent||o("Too many close"),G(t),"x:decl"==t.parent.name&&(t=t.parent,G(t)),t.parent.single?Q(t.parent):t.parent}function V(e){var n=t.substring(se+(0|e),oe);return se=oe,n}function X(e){for(;le>oe;){if(Y=t.charCodeAt(oe),Y===l){var n=W[e](V().trim(),ce);return n.line=ue,n.file=fe,n.parent||ce.append(n),n}oe++}o("Syntax error")}i=i||{},n=n||{};for(var K,Y,Z,te,ee,ne,re,ie,ae,oe=0,se=0,le=t.length,ce=r("#root"),ue=n.line||1,fe=n.file,de=0;le>oe;){if(Y=t.charCodeAt(oe),Y===s&&(ue++,de=oe),void 0===te)Y===_?(se=oe,te=B):Y===w?(R(U(1).trim().replace(/\|$/,"")),ee&&(ee=!1,ce=Q(ce),se=oe)):Y===T?U():Y===b?(se=oe,ce=ce.newChild("div"),te=N):Y===y?(ce=ce.newChild("div"),te=M):Y===g||Y===C?se=oe:Y===l||(Y===c?(ce=Q(ce),se=oe):Y>=j&&(se=oe,te=L)),ce.file=fe,ce.line=ue;else if(te===L){if((Y===u||h>Z&&Y>=h)&&(ne=t.substring(se,oe).trim(),W[ne])){se=oe,ce=X(ne),te=void 0;continue}if(Y===y)te=M;else if(Y===f)te=S;else if(Y===b)te=N;else if(Y===w)te=void 0,ee=!0;else{if(Y===E){te=F;continue}Y===g?te=D:Y===l?te=D:Y>=j&&h>Y&&Y!==$&&(v>Y||Y>x)&&o("Syntax error")}te!==L&&(ce=ce.newChild(V().trim()),ne=ce.name,oe--,/^[a-z_-][a-z0-9_-]*$/i.test(ne)||o('Invalid node name "'+ne+'"',-ne.length/2))}else te===N?(Y===y||j>Y||Y===f)&&(te=Y===y?M:Y===f?S:D,ce.attrs.id='"'+V(1).trim()+'"',oe--):te===M?(j>Y||Y===w||Y===l||Y===f)&&(ce.attrs["class"]='"'+V().trim().split(".").slice(1).join(" ")+'"',oe--,te=Y===f?S:D):te===S?(Y===p||Y===d)&&(void 0===re&&(re=V(1)),Y===d&&(ae=V(1),se=oe+1,ce.attrs[re]="]"===ae?"true":ae,re=void 0,t.charCodeAt(oe+1)!==f&&(te=D))):te===D?Y===w?(R(U(1).trim().replace(/\|$/,"")),se=oe,ce=Q(ce),te=void 0):Y===g?(se=oe+1,te=void 0,ce.single=!0):Y===l&&(te=void 0):te===F||te===q?Y===E?(ae=V().trim(),te===F?(re=ae,K=ce.attrs[re],ce.attrs[re]="",void 0!==K&&"class"===re&&(ce.attrs[re]=K+" ")):(ie=ae,ce.attrs[re][ie]=""),te=P):Y===c&&(te=void 0,void 0===re&&(ce=Q(ce))):te===P?Y===l?(K=ce.attrs[re],ce.attrs[re]={},""!==K&&"class"===re&&(ce.attrs[re][K]=1),se=oe+1,te=q):Y>j&&(ae=J(),void 0===ie?ce.attrs[re]="class"===re?(ce.attrs[re]+ae).replace(/"\s"/," "):ae:(te=q,ce.attrs[re][ie]=ae,ie=void 0),Y===c?(te===q&&oe++,re=void 0,ie=void 0,te=void 0):te!==q&&(re=void 0,ie=void 0,te=void 0)):te===B&&(Y===p?(ce=ce.newChild("x:decl",{name:V(1).trim()}),te=void 0):Y===l?(ce=ce.newChild(V(1).trim()),se=++oe,te=F):Y>=j&&j>Z&&(ce.newChild(V(1).trim(),{"x:context":U()}),te=void 0));Z=Y,oe++}return"#root"!==ce.name&&(console.log(ce),ce.exception("not closed")),ce};t.exports=R})()}),t("compile",function(t){function e(t,n,r){return e.pre(t,n),e.code(t,r)}e.pre=function n(t,e){var r,i=t.name,a=e[i],o=t.attrs;if(!t.noPre){if(void 0===a||(r=a(t,t.attrs)),r!==!0&&(r=e["**"](t,t.attrs)),r===!0)return n(t.parent,e),void 0;for(i in o)if(a=e["@"+i],void 0!==a&&a.call(e,t,i,o[i])===!0||e["@"].call(e,t,i,o[i])===!0)return delete o[i],n(t.parent,e),void 0}for(var s=t.children.slice(0),l=0,c=s.length;c>l;l++)n(s[l],e)},e.code=function r(t,n){var i,a,o,s,l,c=t.name,u=n[c],f=t.children,d="",p=t.binding,h=t.decl,v=t.events,x=(p.length||h||v)&&e.xpath(t),m="",g="",_="";if(i=void 0===u?n["**"](c,t,t.attrs):""===u?["",""]:u(t,t.attrs),t.xctrl&&(i[0]=e.tryCatch(t,'xtpl.ctrl["_'+t.xctrl+'"](ctx)')+i[0]),a=p.length){var y,b=0;for(o=0;a>o;o++){if(l=p[o],m+=",__xbind"+o,"x:if"==l.name)s=e.getExpr(l,"test"),b=1,l.attrs.test="__xbind"+o;else if("x:else"==l.name)s=e.getExpr(l,"if"),b=1,l.attrs.test="__xbind"+o;else if("x:value"==l.name)s=e.getExpr(l,"data"),l.attrs.data="__xbind"+o;else if("x:var"==l.name){var w=l.key;if(l.expr){var C=e.getExpr(l,w,l.value);s=e.tryCatch(l,"__xval="+C),"context"==w?(g=s+"if( __xval instanceof Object ) for( var key in __xval ){"+"  __xval0 = __xval[key];"+"  __xargs[key] = __xval0;"+'  __xargs["__"+key] = __xclone(__xval0);'+"  __xc = 1;"+"}"+g,_='for( var key in __xargs ){  if( !/^__/.test(key) ){    __xval = __xargs[key];    if( __xnotEq(__xval, __xargs["__"+key]) ){'+e.tryCatch(l,C+"[key] = __xval;")+"       __xc = 1;"+"    }"+"  }"+"}"+_):(g+=s+'  __xargs["'+w+'"] = __xval;'+'  __xargs["__'+w+'"] = __xclone(__xval);'+"  __xc = 1;",_+='__xval=__xargs["'+w+'"];'+'if( __xnotEq(__xval, __xargs["__'+w+'"]) ){'+e.tryCatch(l,C+" = __xval;")+"  __xc = 1;"+"}")}else g+='__xargs["'+w+'"]='+e.lex(l.value)+";";continue}g+=e.tryCatch(l,"__xargs["+o+"]="+s),l.attrs.safe=!0}"x:attr"==c?(b=3,y=e.lex(t.attrs.name)):"x:decl"===c&&(b=5,y=e.lex(t.declName),m=" ctx,__xsync",g="var __xc;if(apply===void 0){"+g+"}else{"+_+"}return __xc"),i[0]+="__buf.b("+b+", ["+x+"],function(__xargs,apply){"+g+"},function("+m.substr(1)+"){",i[1]="}"+(y?","+y:"")+");"+i[1],"x:decl"===c&&(i[0]+="var ___$apply=__buf.$apply, __$apply=__buf.$apply=function(force){if( __xsync(ctx,true) || force === true ){ ___$apply(true) }};")}if(v)for(o=0,a=v.length;a>o;o+=2)i[1]+="__buf.b(4,["+x+"],"+e.lex(v[o])+",function(evt){evt.preventDefault();"+v[o+1]+"\n __$apply()"+"});";if(h)for(o=0,a=h.length;a>o;o+=2)i[1]+="__buf.b(5,["+x+"],function(__xargs){"+e.tryCatch(t,"__xargs["+o+"]="+h[o+1])+"\nreturn __xargs},"+e.lex(h[o])+");";for(a=f.length,o=0;a>o;o++)d+=r(f[o],n);return(i[0]+d+i[1]).replace(/"\)\n__buf\.s\("/g,"").replace(/{;_/g,"{_")},e.lex=function(t){return JSON.stringify(t)},e.str=function(t){return"__buf.s("+e.lex(t)+")\n"},e.variable=function(t,n,r){return e.expr(t,"__buf.w($"+n+(r?',"'+r+'"':"")+");")},e.tryCatch=function(t,e,n){return"try{"+e+"}catch(e){"+(n||"")+(t.file?';__xerr(e,"'+t.file+'",'+t.line+")}":"}")},e.expr=function(t,n){var r="",i=0;return n=n.replace(/([\$@&])([\w-]+)/g,function(n,a,o){var s=t.attrs[o];return"$"!=a||t.attrs.safe?"@"==a&&(s=e.lex(s)):(s=e.getExpr(t,o),o="__xval"+i++,r+=e.tryCatch(t,o+"="+s,o+"=void 0"),s=o),s}),r+n},e.getExpr=function(t,e,n){var r=void 0===n?t.attrs[e]:n;try{Function('"use strict";\n'+r)}catch(i){try{Function('"use strict";\n('+r+")")}catch(a){t.exception(' attribute "'+e+'": '+i.message+"\n---\n"+r+"\n---")}}return r},e.wrap=function(t,e){if(!t.binded){do{var n=t.parent,r=n.children,i=r.length,a=i,o=/#text|value/,s=0;if(e=e||t.attrs.bind,i>1){for(;a--;)r[a].hidden&&t!==r[a]&&i--;a=i}if("both"==e&&(1!=t.length||o.test(t.first.name)))return t.innerWrap("x"),!0;if(1===i)"both"==n.bindMod&&n.innerWrap("x"),t.sys&&n.sys&&(n=t.wrap("#scope"),n.sys=1,n.hidden=1),t.manualBind||n.manualBind||n.bind(t);else if(o.test(t.name)){for(;a--;)if(!o.test(r[a].name)&&!r[a].hidden)return t.wrap("x"),!0;t.manualBind||n.manualBind||n.bind(t)}else("wrap"==e||"both"==e)&&(t.wrap("x"),s=1)}while(s);t.bindMod=e,delete t.attrs.bind}},e.xpath=function(t,e){var n=t.xpath;if(e=t.attrs.x||e,void 0!==n)return n;if(n=[],e&&console.group(t.name+": "+JSON.stringify(t.attrs)),t.parent)do for(var r=t.parent.children,i=0,a=r.length,o=0;a>i;i++)if(e&&console.log(r[i].hidden,o,""+r[i]),r[i].pseudoRoot)o=0;else if(!r[i].hidden){if(r[i]===t){n.push(o);break}o++}while((t=t.parent)&&t.parent&&!t.sys);return e&&(console.log("xpath:",n),console.groupEnd()),n},t.exports=e}),t("buffer",function(t,e,n){function r(t){var e,n=t.min,i=n,a=t.max;if(void 0!==n)for(;a>=i;i++)e=t[i],void 0!==e&&(e.zmb=1,r(e))}function i(t,e,n,r,i,s){var l=0,u=e.childNodes,f=r.extra,d=document.createElement("div"),p=r.render,v=[];h(i,function(i,c){if(void 0===f||f(i)){var h,x=s[l],m=u[l];i!==x&&(n.remove(l),t.idx=l,t.xpath=r.xpath,t.clear(),p(i,c),h=a(d,""+t),void 0===m?e.appendChild(h):o(m,h,e)),v[l]=i,l++}});for(var x=u.length-1;x>=l;x--)c(u[x],t._decl,!0),n.remove(x),e.removeChild(u[x]);return d=null,v}function a(t,e){return/^<option/i.test(e)?(t.innerHTML="<select>"+e+"</select>",t=t.firstChild):/^<tr/.test(e)?(t.innerHTML="<table><tbody>"+e+"</tbody></table>",t=t.firstChild.firstChild):t.innerHTML=e,t.firstChild}function o(t,e,n){void 0===n&&(n=t.parentNode),n.insertBefore(e,t),n.removeChild(t)}function s(t,e){if(void 0!==e.el)return e.el;for(var n=e.xpath,r=n.length;r--&&(t=t.childNodes[n[r]]););return e.el=t}function l(t,e){for(var n=e.length;n--&&(t=t.childNodes[e[n]],null!=t););return t}function c(t,e,n){var r,i=t.getElementsByTagName("*"),a=e[t.xdecl];for(n===!0&&(void 0!==t.xevents&&p(t),void 0!==a&&void 0!==a.remove&&a.remove(t,t.parentNode)),r=i.length;r--;)t=i[r],a=e[t.xdecl],void 0!==t.xevents&&p(t),void 0!==a&&void 0!==a.remove&&a.remove(t,t.parentNode)}function u(t,e){var n,r=t;if(t instanceof Array)for(n=t.length,r=[];n--;)r[n]=e?t[n]:u(t[n]);else if(t instanceof Function)r=t;else if(t instanceof Object){r={};for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n])}return r}function f(t,e,n,r){var i,a,o,s=t.xevents=t.xevents||x++;r.gid=r.gid||x++,C[s]||(C[s]={}),C[s][n]||(C[s][n]=[]),o=C[s][n],i=E[r.gid]=E[r.gid]||d(t,r),a=T(r,o),t.addEventListener?t[e?"addEventListener":"removeEventListener"](n,i,!1):t[e?"attachEvent":"detachEvent"]("on"+n,i),e===!0?~a||o.push(r):(~a||(o.splice(a,1),delete E[r.gid]),~o.length&&delete C[s][n],O(C[s])&&delete C[s])}function d(t,e){return function(n){n=n||window.event,n.target||(n.target=n.srcElement||document),3===n.target.nodeType&&(n.target=n.target.parentNode),n.currentTarget||(n.currentTarget=t),!n.relatedTarget&&n.fromElement&&(n.relatedTarget=n.fromElement===n.target?n.toElement:n.fromElement),n.stopPropagation||(n.stopPropagation=function(){this.cancelBubble=!0}),n.preventDefault||(n.preventDefault=function(){this.returnValue=!1}),e.call(t,n)===!1&&(n.preventDefault(),n.stopPropagation())}}function p(t){var e,n,r,i=t.xevents,a=C[i];if(a)for(e in a)for(r=a[e],n=r.length;n--;)f(t,0,e,r[n])}function h(t,e){if(t){var n,n=0,r=t.length;if(void 0!==r&&n in t)for(;r>n;n++)e(t[n],n);else for(n in t)t.hasOwnProperty(n)&&e(t[n],n)}}var v=0,x=1,m=1,g=2,_=3,y=4,b=5,w={autofocus:1,autoplay:1,async:1,checked:1,controls:1,defer:1,disabled:1,hidden:1,loop:1,multiple:1,open:1,readonly:1,required:1,scoped:1,selected:1},C={},E={},$=n("utils"),k=$.isClient,A=k&&(window.opera||/MSIE/.test(navigator.userAgent)),T=$.inArray,O=$.isEmptyObject,j=$.notEqual,N=$.escapeHTML,L=k&&"cssText"in document.createElement("div").style,S=function(t){this.id=++v,this._=[],t&&(this.ids={},this.index=[])};S.prototype={constructor:S,get:function(t){for(var e,n=t.length,r=this;n--;)e=t[n],r=r[e]||S.Null;return r},push:function(t,e){for(var n,r,i=t.xpath,a=i.length,o=this;a--;)n=i[a],r=o[n],(void 0===r||void 0!==r.zmb)&&(o[n]=new S,o.min=void 0===o.min?n:Math.min(o.min,n),o.max=Math.max(0|o.max,n)),o=o[n];o.idx=i[0],o.label=e,1===o._.push(t)&&(o.type=t.type);var s=this.ids;return void 0===s[o.id]&&(s[o.id]=1,this.index.push(o)),t},removeItem:function(t){for(var e=this.get(t.xpath),n=e._,r=n.length;r--;)if(n[r]===t){n.splice(r,1);break}},remove:function(t){var e,n=this,i=t.length;if("object"==typeof t)for(;i--;)void 0!==n&&(e=t[i],n=n[e]);else n=n[t];n&&(n.zmb=1,r(n))},empty:function(t){r(this),t&&this._.length>1&&this._.splice(1,10)},each:function(t){for(var e,n,r=this,i=r.index,a=0,o=i.length,s={};o>a;)if(r=i[a],1!==r.zmb){a++,e=r._;for(var l,c=0;void 0!==e[c];c++)l=e[c],n=l.label,void 0===s[n]&&t(r,l)===!1&&(s[n]=1)}else o--,i.splice(a,1)}},S.Null=new S;var D=function(t,e){this.el=t,this.data=A?[]:"",this.xpath=[],this.events=[],this.idxQueue=[],this.bindDecl=[],this.bindData=new S(!0),this.applyFns=[],this._decl=e,this.$apply=this.applyChanges.bind(this)};D.prototype={s:A?function(t){this.data.push(t)}:function(t){this.data+=t},w:function(t,e){void 0!==t&&("text"===e?this.s(t):this.s(N(t)))},save:function(){this.__data=this.data,this.data=A?[]:""},revert:function(){this.data=this.__data},each:function(t,e,n){if(t){var r,i=0,a=t.length,o=0,s=this.idx;if(void 0!==a&&0 in t)for(;a>i;i++)r=t[i],(void 0===n||n(r,i))&&(this.idx=o++,e(r,i));else for(i in t)r=t[i],t.hasOwnProperty(i)&&(void 0===n||n(r,i))&&(this.idx=o++,e(r,i));this.idx=s}},b:function(t,e,n,r,i){var a,o=this.idx,s=this.xpath,l=this.xlabel,c=e.length,f=[];if(void 0!==o&&(0===c?e[0]=o:e[c-1]=o,delete this.idx),e=e.concat(s),t===y)this.events.push({name:n,fn:r,xpath:e});else if(n(f),t===g?f[0]=u(f[0],!0):t===b&&void 0!==i?this.xlabel=x++:f=u(f),this.bindData.push(a={type:t,xpath:this.xpath=e,args:f,getter:n,render:r,extra:i,label:this.xlabel}),t===g)this.each(f[0],r,i);else if(t===b)this.bindDecl.push(a),void 0!==i&&(r(f,n),a.$apply=this.$apply);else if(t===_){this.save(),r.apply(this,f);var d=""+this;this.revert(),""!==d&&"false"!==d&&this.s(" "+i+'="'+d+'"')}else r.apply(this,f);this.idx=o,this.xpath=s,this.xlabel=l},clear:function(){this.data=A?[]:""},toString:A?function(){return this.data.join("")}:function(){return this.data},applyChanges:function(t){var e=this,n=e.el;"function"==typeof t&&this.applyFns.push(t),this.bindData.each(function(t,r){var a,o,l,f=[],d=r.args,p=r.type,h=r.extra,v=r.getter,x=e.idx,y=e.xpath,C=e.$apply;if(p===b&&void 0!==h){if(o=!0,void 0===v(f=d))return!1;e.$apply=r.$apply}else if(v(f),p===g)o=!0;else for(a=f.length;a--;)j(d[a],f[a])&&(f[a]=u(f[a]),o=!0);if(o){if(e.xpath=r.xpath,l=s(n,r),p===g)f[0]=i(e,l,t,r,f[0],d[0]);else if(p===b){var E=e._decl[h||r.render];void 0!==E.update&&(void 0===h?E.update(l,f[0],d[0]):E.update(l,d))}else{e.clear(),p===_?e.w=e.s:t.empty(p===m),r.render.apply(e,f);var $=""+e;p===_?(e.w=e._w,"value"===h?l.value!==$&&(l.value=$):"class"===h?l.className=$:void 0!==w[h]?l[h]=""!==$&&"false"!==$:"style"===h&&L?l.style.cssText=$:l.setAttribute(h,$)):(c(l,e._decl),l.innerHTML=$)}e.idx=x,e.xpath=y,e.$apply=C,r.args=f}}),this.applyEnd()},applyEnd:function(){var t,e,n,r,i,a=this.bindDecl,o=this.events,c=this.applyFns;for(t=a.length;t--;)i=a[t],n=s(this.el,i,!0),void 0===n?console.log("decl.error:",i.xpath,i):(r=this._decl[n.xdecl=i.extra||i.render],void 0!==r.init&&r.init(n,i.extra?i.args:i.args[0]));for(t=o.length;t--;)r=o[t],f(l(this.el,r.xpath,!0),!0,r.name,r.fn);for(this.events=[],this.bindDecl=[],this.applyFns=[],t=0,e=c.length;e>t;t++)c[t]()},destory:function(){c(this.el,this._decl,!0)}},D.prototype._w=D.prototype.w,t.exports=D}),t("xtpl",function(t,e,n){var r=n("utils"),i=n("xparser"),a=n("xmlparser"),o=n("compile"),s=n("buffer"),l=r.isClient,c=l&&window.xtpl,u=l?location.pathname:__dirname,f={},d={},p={},h={},v={"#text":function(t){return t.replace(/\{\{(.*?)\}\}/g,"<x:value bind>$1</x:value>").replace(/\{\*(.*?)\*\}/g,'<x:value output="text" bind>$1</x:value>')},"x:text":function(t,e){var n=t.first?t.first.value:e.value;return n},"x:space":" ","x:enter":"\n","x-space":" ","x-enter":"\n"},x=r.each,m=r.extend,g=function(t,e){var n={},r=this;"object"==typeof t?n=t:n[t]=e,x(n,function(t,e){if(t.pre||t.code){t.pre&&g.call(d,e,t.pre),t.code&&g.call(p,e,t.code);var n=t.children;n&&(v[e]=function(t){var e=t.children,r=t.length;if(n)for(0===r&&t.exception("can not be empty");r--;)-1===n.indexOf(e[r].name)&&t.exception("can contain only: "+n.replace(/\s/g,", "))})}else r[e]=r[e.replace(":","-")]=t})},_=function(t){var e=["",""];return x(r.matchAll(t,/(?:\|\|)|(\|\s*([a-z]+[^|]+))/g),function(n){var r=n[0].trim().split(":");e[0]="__xmods."+r[0].replace(/\|\s*/,"")+"("+e[0],e[1]=e[1]+(r.length>1?","+r.slice(1).join(","):"")+")",t=t.replace(n[0],"")}),e[0]+t+e[1]};l&&document.createElement("x");var y={xml:!1,each:x,cache:f,mods:{},utils:r,parse:function(t){return a(t,{file:u},v)},xparse:function(t){return i(t,{file:u},v)},compile:function(t,e,n){var r,s=f[e];if(void 0===s){try{"string"==typeof t&&(t=n===!0?a(t,{file:e||u},v):i(t,{file:e||u},v)),r=o(t,d,p),s=Function("return "+r)()}catch(l){s=Function("return function(__buf){"+o.str("<pre>"+l.message+"\nline: "+l.line+"\nfile: "+l.file+"</pre>")+"return __buf.toString()}")(),l.stack&&console.log(l.stack)}void 0!==e&&(f[e]=s)}return s},ctrl:function(t,e){y.ctrl["_"+t]=e},mod:function(t,e){y.mods[t]=e},bind:function(t,e,n,r){var i=y.xml;void 0===r&&(r=i),y.xml=r;var a="string"==typeof e?y.compile(e,void 0,r):e,o=new s(t,h);return n=n||{},n.xel=t,n.xfn=a,n.xbuffer=o,n.$set=function(t,e){n[t]=e,n.$apply()},n.$delay=function(t,e){return setTimeout(function(){t(),n.$apply()},e)},n.$loop=function(t,e){return setInterval(function(){t(),n.$apply()},e)},n.$clear=function(t){clearTimeout(t)},n.$apply=o.$apply,t.innerHTML=a(o,n),o.applyEnd(),y.xml=i,n},pre:g.bind(d),tag:g.bind(p),decl:function(t,e){var n;"object"==typeof t?n=t:(n={},n[t]=e),x(n,function(t,e){"function"==typeof t&&(t={init:t,update:t}),t=h[e]=m(h[e],t),h[e.replace("x:","x-")]=t,t.tpl?d[e]=function(n,r){var i="string"==typeof t.tpl?y[y.xml?"parse":"xparse"](t.tpl).first:t.tpl.clone(),a=i.find("x:content");return a.length&&(a[0].hidden=1,a[0].appendArray(n.children)),i.hidden=1,n.name="x:decl",n.sys=1,n.declName=e,n.empty().append(i),x(r,function(t,e){n.bind({name:"x:var",key:e.replace(/^x[:-]/,""),expr:/^x[:-]/.test(e),value:t})}),!0}:d["@"+e.replace("x:","x-")]=d["@"+e]=function(e,n,r){return t.compile&&t.compile(e,r),(t.init||t.update||t.remove)&&e.bindDecl(n,r),!0}})},noConflict:function(){return window.xtpl=c,y}};y.pre({"@":function(t,e,n){if("string"==typeof n&&-1!==n.indexOf("{{")){var r=t.create("x:attr",{name:e});return t.append(r,t.first),x(n.match(/\{\{[^}]*\}\}|\{[^{]+|[^{]+/g),function(n){if(""!==n){var i=r.newChild("#text");i.file=t.file,i.line=t.line,"{{"===n.substr(0,2)?(i.name="x:value",i.attrs.data=o.getExpr(t,e,_(n.slice(2,-2)))):i.value=n}}),!0}},"@x:ctrl":function(t,e,n){t.xctrl=n.replace(/"/g,""),delete t.attrs[e]},"@x:if":function(t,e,n){return t.wrap(e,{test:n}),!0},"@x:each":function(t,e,n,r){return n=n.match(/^\(?(\w+)(?:\s|,)\s*(\w+)?\)?\s*in\s*([^\|]+)(\|.+)?/i),t[r||"innerWrap"]("x:each",{data:n[3],as:n[2]||n[1],key:n[2]?n[1]:"$index",filter:/^\|/.test(n[n.length-1])?n.pop().substr(1):void 0}),!0},"@x:eval":function(t,e,n){t.newChild("x:eval",{source:n}),delete t.attrs[e]},"@x:repeat":function(t,e,n){return this["@x:each"](t,e,n,"wrap")},"@x:model":function(t,e,n){var r=t.attrs.type;return"text"==r?(t.newChild("x:attr",{name:"value"}).newChild("x:value",{data:n}),t.on("input",n+"=evt.target.value")):(t.newChild("x:attr",{name:"checked"}).newChild("x:value",{data:n}),t.on("change",n+"=!"+n)),!0}}),x("change select submit click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleaveinput keydown keypress keyup".split(" "),function(t){y.pre("@x:"+t,function(t,e,n){return t.on(e,n),!0})}),v["x:decl"]=v["x-decl"]=function(t,e){e.name&&(t.remove(),y.decl(t.attrs.name,{tpl:t.first}))},y.tag({"#root":function(){return["function _(__buf,ctx){var __xerr=xtpl.utils.error,__xlog=xtpl.utils.print,__xnotEq=xtpl.utils.notEqual,__xclone=xtpl.utils.simpleClone,__xmods=xtpl.mods,__xval,__xval0,__xval1,__xval2,__xval3,__xval4,__$apply=__buf.$apply,__ctx=ctx;","__buf.$apply=__$apply;return __buf.toString()}"]},"#text":function(t){return[o.str(t.value),""]},"#scope":function(){return["",""]},"x:ctrl":{pre:function(t,e){t.xctrl=e.name,t.hidden=1},code:function(){return["",""]}},"x:decl":function(){return["",""]},"x:content":function(){return["",""]},"x:value":{children:"#cdata #text",pre:function(t,e){e.bind="false"!==e.bind,e.data=_(t.first?t.first.remove().value:e.data)},code:function(t,e){return[o.variable(t,"data",e.output),""]}},"x:if":{pre:function(t,e){e.bind="false"!==e.bind&&"wrap",t.sys=e.bind,t.hidden=1,t.braces=1},code:function(t){return[o.expr(t,"if($test){"),Array(t.braces+1).join("}")]}},"x:else":{pre:function(t,e){t.hidden=1,t.pseudoRoot=!0,e["if"]&&(t.sys=1,t.parent.braces++,t.parent.parent.bind(t))},code:function(t,e){var n="";return e["if"]&&(n="if($if){"),["} else {\n"+o.expr(t,n),""]}},"x:each":{pre:function(t,e){t.sys=1,t.hidden=1,t.manualBind=!0,e.bind="both"},code:function(t,e){return t.binded=!0,["__buf.b(2, ["+o.xpath(t)+"],function(__xargs){"+o.tryCatch(t,"__xargs[0]="+e.data)+o.expr(t,"},function(&as,&key){"),o.expr(t,"},&filter);")]}},"x:eval":{pre:function(t,e){t.sys=1,t.hidden=1,t.manualBind=!0,e.bind=!0},code:function(t,e){return t.binded=!0,["__buf.b(0, ["+o.xpath(t)+"],function(__xargs){"+o.tryCatch(t,"__xargs[0]="+e.source)+"},function(__xsource){"+"  var fn = xtpl.compile(__xsource, void 0, "+y.xml+");"+"  fn(__buf, ctx);","});"]}},"x:attrs":function(){return["",""]},"x:attr":{pre:function(t){var e=t.parent,n=e.xattrs;if(void 0===n){if("x:attrs"===e.name)return;n=e.xattrs=t.create("x:attrs"),n.allow=e.attrs["x:attrs-bind"],n.hidden=1,e.append(n,e.first),delete e.attrs["x:attrs-bind"]}t.hidden=1,t.manualBind=null!=n.allow&&-1==n.allow.indexOf(t.attrs.name),n.append(t.remove())},code:function(t){var e=t.manualBind;return[e?o.str(" "+t.attrs.name+'="'):"",e?o.str('"'):""]}},"**":{pre:function(t,e){return void 0===e.bind||e.bind||(t.hidden=1),e.bind&&o.wrap(t)},code:function(t,e,n){var r,i,a=[""],s="",l=e.shorty;for(r in n)i=n[r],a.push(r+(i===!0?"":"="+o.lex(i)));return a=a.length>1?a.join(" "):"",e.xattrs&&(s+=o(e.xattrs,d,p),e.xattrs.remove()),a+=l?"/>":">",[o.str("<"+t)+s+o.str(a),l?"":o.str("</"+t+">")]
}}}),y.decl({"x:show":{compile:function(t,e){var n=t.attrs;n.style=(n.style||"")+";{{"+e+" ? '' : 'display: none;'}}"}},"x:hide":{compile:function(t,e){var n=t.attrs;n.style=(n.style||"")+";{{"+e+" ? 'display: none;' : ''}}"}},"x:fade-to":function(t,e){t.style.opacity=0|e}}),y.mod("css",function(t,e){return e?t:""}),r.isClient&&function(t,e){var n=!1,r="load",i="onload",a="complete",o="DOMContentLoaded",s="onreadystatechange",l=function(){if(t.addEventListener)t.removeEventListener(r,l,!1),e.removeEventListener(o,l,!1);else{if(e.readyState!==a)return;t.detachEvent(i,l),e.detachEvent(s,l)}c()},c=function(){for(var t,n,r,i,a,o,s=e.scripts,l=s.length;l--;)t=s[l],n=t.getAttribute("type"),r=t.getAttribute("x-ctrl")||t.getAttribute("x:ctrl")||t.getAttribute("ctrl"),(r||/xtpl/.test(n))&&(i=e.createElement("div"),o=t.innerHTML,a=t.parentNode,/xml/.test(n)?(o="x-ctrl"+(r?' name="'+r+'"':"")+">"+o+"</div>",y.bind(i,o,{},!0)):(o="div"+(r?"[x-ctrl="+r+"]":"")+" {\n"+o+"\n}",y.bind(i,o)),a.insertBefore(i,t),a.removeChild(t))};if(e.readyState===a)setTimeout(l,1);else if(t.addEventListener)t.addEventListener(r,l,!1),e.addEventListener(o,l,!1);else{t.attachEvent(i,l),e.attachEvent(s,l);try{n=null==t.frameElement&&e.documentElement}catch(u){}n&&n.doScroll&&function f(){try{n.doScroll("left"),l()}catch(t){setTimeout(f,50)}}()}}(window,document),t.exports=y}),e("xtpl")});